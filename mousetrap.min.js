/*global define:false */
!function(e,t,n){function r(e,t,n,r){var r=r||!1
if(e.addEventListener)return void e.addEventListener(t,n,r)
e.attachEvent("on"+t,n)}function i(e){if("keypress"==e.type){var t=String.fromCharCode(e.which)
return e.shiftKey||(t=t.toLowerCase()),t}return m[e.which]?m[e.which]:k[e.which]?k[e.which]:String.fromCharCode(e.which).toLowerCase()}function o(e,t){return e.sort().join(",")===t.sort().join(",")}function a(e){var t=[]
return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function c(e){if(e.preventDefault)return void e.preventDefault()
e.returnValue=!1}function u(e){if(e.stopPropagation)return void e.stopPropagation()
e.cancelBubble=!0}function l(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function s(){if(!v){v={}
for(var e in m)e>95&&e<112||m.hasOwnProperty(e)&&(v[m[e]]=e)}return v}function f(e,t,n){return n||(n=s()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function p(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus"),e.split("+"))}function d(e,t){var n,r,i,o=[]
for(n=p(e),i=0;i<n.length;++i)r=n[i],g[r]&&(r=g[r]),t&&"keypress"!=t&&b[r]&&(r=b[r],o.push("shift")),l(r)&&o.push(r)
return t=f(r,o,t),{key:r,modifiers:o,action:t}}function h(e,n){return null!==e&&e!==t&&(e===n||h(e.parentNode,n))}function y(e,n){function s(e){e=e||{}
var t,n=!1
for(t in w)e[t]?n=!0:w[t]=0
n||(C=!1)}function f(e,t,n,r,i,a){var c,u,s=[],f=n.type
if(!b._callbacks[e])return[]
for("keyup"==f&&l(e)&&(t=[e]),c=0;c<b._callbacks[e].length;++c)if(u=b._callbacks[e][c],(r||!u.seq||w[u.seq]==u.level)&&f==u.action&&("keypress"==f&&!n.metaKey&&!n.ctrlKey||o(t,u.modifiers))){var p=!r&&u.combo==i,d=r&&u.seq==r&&u.level==a;(p||d)&&b._callbacks[e].splice(c,1),s.push(u)}return s}function p(e,t,n,r){b.stopCallback(t,t.target||t.srcElement,n,r)||!1===e(t,n)&&(c(t),u(t))}function h(e){"number"!=typeof e.which&&(e.which=e.keyCode)
var t=i(e)
if(t)return"keyup"==e.type&&_===t?void(_=!1):void b.handleKey(t,a(e),e)}function v(){clearTimeout(g),g=setTimeout(s,1e3)}function m(e,t,n,r,o){function a(t){p(n,t,e),"keyup"!==r&&(_=i(t)),setTimeout(s,10)}w[e]=0
for(var c=0;c<t.length;++c){var u=c+1===t.length,l=u?a:function(t){return function(){C=t,++w[e],v()}}(r||d(t[c+1]).action)
k(t[c],l,r,e,c,o)}}function k(e,t,n,r,i,o){var o=o||!1
b._directMap[e+":"+n]=t,e=e.replace(/\s+/g," ")
var a,c=e.split(" ")
if(c.length>1)return void m(e,c,t,n,o)
a=d(e,n),b._callbacks[a.key]=b._callbacks[a.key]||[],f(a.key,a.modifiers,{type:a.action},r,e,i),b._callbacks[a.key][r?"unshift":"push"]({callback:t,modifiers:a.modifiers,action:a.action,seq:r,level:i,combo:e})}var b=this,n=n||!1
if(e=e||t,!(b instanceof y))return new y(e,n)
b.target=e,b._callbacks={},b._directMap={}
var g,w={},_=!1,K=!1,C=!1
b._handleKey=function(e,t,n){var r,i=f(e,t,n),o={},a=0,c=!1
for(r=0;r<i.length;++r)i[r].seq&&(a=Math.max(a,i[r].level))
for(r=0;r<i.length;++r)if(i[r].seq){if(i[r].level!=a)continue
c=!0,o[i[r].seq]=1,p(i[r].callback,n,i[r].combo,i[r].seq)}else c||p(i[r].callback,n,i[r].combo)
var u="keypress"==n.type&&K
n.type!=C||l(e)||u||s(o),K=c&&"keydown"==n.type},b._bindMultiple=function(e,t,n,r){for(var i=0;i<e.length;++i)k(e[i],t,n,r)},r(e,"keypress",h,n),r(e,"keydown",h,n),r(e,"keyup",h,n)}if(e){for(var v,m={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},k={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},b={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},g={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},w=1;w<20;++w)m[111+w]="f"+w
for(w=0;w<=9;++w)m[w+96]=w.toString()
y.prototype.bind=function(e,t,n,r){var i=this,r=r||!1
return e=e instanceof Array?e:[e],i._bindMultiple.call(i,e,t,n,r),i},y.prototype.unbind=function(e,t){var n=this
return n.bind.call(n,e,function(){},t)},y.prototype.trigger=function(e,t){var n=this
return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n},y.prototype.reset=function(){var e=this
return e._callbacks={},e._directMap={},e},y.prototype.stopCallback=function(e,t){var n=this
return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!h(t,n.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},y.prototype.handleKey=function(){var e=this
return e._handleKey.apply(e,arguments)},y.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(m[t]=e[t])
v=null},y.init=function(){var e=y(t)
for(var n in e)"_"!==n.charAt(0)&&(y[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n))},y.init(),e.Mousetrap=y,"undefined"!=typeof module&&module.exports&&(module.exports=y),"function"==typeof define&&define.amd&&define(function(){return y})}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)
